%h1 Week View

.well
  Displaying facts from
  %strong= l(@week_start, format: :with_day_name)
  to
  %strong= l(@week_end, format: :with_day_name)

.well
  %h4 Projects
  = render 'grouped_by_activity', facts: @facts

  %h4 Total
  = render_minutes(@facts.inject(0) {|sum, f| sum + f.duration_in_minutes }).join(':')

%table.table.table-bordered.table-hover
  %thead
    %tr
      %th
        id
      %th
        activity
      %th
        description & tags
      %th
        time
      %th
        duration
      %th
        action
  %tbody
    -@facts.group_by{|f| f.start_time.to_date }.each do |day, facts| # day
      %tr
        %td{colspan: 6}
          = l(day, format: :with_day_name)
      -facts.each do |fact|
        %tr
          %td
            = fact.id
          %td
            %span{title: fact.activity.id}= fact.activity.name
          %td
            = fact.description
            - fact.tags.each do |tag|
              = link_to tag.name, tag
          %td
            = l(fact.start_time, format: :time_only)
            &minus;
            = l(fact.end_time, format: :time_only)
          %td
            = fact.duration.join(":")
          %td
            = link_to "export", export_fact_path(fact), class: 'btn'
      %tr
        %td{colspan: 6}
          = render 'grouped_by_activity', facts: facts

.pagination.pagination-centered
  %ul
    %li
      = link_to "<<", week_facts_path(week_nr: @week_nr - 1, year: @year)
    %li
      = link_to @week_nr - 1, week_facts_path(week_nr: @week_nr - 1, year: @year)
    %li.active
      = link_to @week_nr, "#"
    %li
      = link_to @week_nr + 1, week_facts_path(week_nr: @week_nr + 1, year: @year)
    %li
      = link_to ">>", week_facts_path(week_nr: @week_nr + 1, year: @year)


